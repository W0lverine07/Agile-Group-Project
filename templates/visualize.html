<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics | Wellness Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles_visualize.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{{ url_for('static', filename='js/visualize.js') }}"></script>
</head>
<body>
  <header>
    <div class="left-header">
      <a href="{{ url_for('main.home') }}" class="logo-link">
        <img src="https://i.pinimg.com/originals/6d/e1/7f/6de17f9493638040838c12f4c947365b.gif"
             alt="Wellness Tracker Logo" class="logo">
      </a>
      <h1>Wellness Tracker</h1>
    </div>
    <div class="nav-buttons">
      <a href="{{ url_for('main.dashboard') }}"><button><i class="fas fa-chart-line"></i> Dashboard</button></a>
      <a href="{{ url_for('main.upload') }}"><button><i class="fas fa-upload"></i> Record Activity</button></a>
      <a href="{{ url_for('main.share_page') }}"><button><i class="fas fa-share"></i> Share</button></a>
      <a href="{{ url_for('main.logout') }}"><button class="logout-btn"><i class="fa-solid fa-arrow-right-from-bracket"></i> Logout</button></a>
            <div class="dropdown">
            <button class="dropbtn"><i class="fas fa-bars"></i> More</button>
            <div class="dropdown-content">
                <a href="{{ url_for('main.gallery') }}"><i class="fas fa-image"></i> Gallery</a>
                <a href="{{ url_for('main.faqs') }}"><i class="fas fa-question-circle"></i> FAQ's</a>
                <a href="{{ url_for('main.history') }}"><i class="fas fa-history"></i> History</a>
                <a href="{{ url_for('main.contact') }}"><i class="fas fa-phone"></i> Contact Us</a>
            </div>
        </div>
    </div>
  </header>

  <main class="content">
    <h2>Activity Analytics</h2>
    <p class="welcome-message">Hi {{ username }}! Here's a detailed analysis of your activities.</p>

    <!-- Dashboard filters -->
    <div class="filter-controls">
      <div class="date-filter">
        <label for="time-period">Time Period:</label>
        <select id="time-period">
          <option value="week" {% if time_period == 'week' %}selected{% endif %}>Last 7 Days</option>
          <option value="month" {% if time_period == 'month' %}selected{% endif %}>Last 30 Days</option>
          <option value="year" {% if time_period == 'year' %}selected{% endif %}>Last 12 Months</option>
        </select>
      </div>
      <div class="data-filter">
        <label>Data to Show:</label>
        <div class="checkbox-group">
          <input type="checkbox" id="show-duration" checked>
          <label for="show-duration">Duration</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="show-calories" checked>
          <label for="show-calories">Calories</label>
        </div>
      </div>
    </div>

    <!-- Main visualization area with multiple charts -->
    <div class="charts-container">
      <div class="chart-card">
        <h3>Activity Overview</h3>
        <div class="chart-wrapper">
          <canvas id="activityChart"></canvas>
        </div>
      </div>
      
      <div class="chart-card">
        <h3>Daily Progress</h3>
        <div class="progress-indicators">
          <div class="progress-item">
            <div class="progress-title">Exercise Duration</div>
            <div class="progress-value" id="duration-progress">0/60 mins</div>
            <div class="progress-bar">
              <div class="progress-fill" id="duration-fill" style="width: 0%;"></div>
            </div>
          </div>
          <div class="progress-item">
            <div class="progress-title">Calories</div>
            <div class="progress-value" id="calories-progress">0/500</div>
            <div class="progress-bar">
              <div class="progress-fill" id="calories-fill" style="width: 0%;"></div>
            </div>
          </div>
          <div class="progress-item">
            <div class="progress-title">Weekly Goal</div>
            <div class="progress-value" id="weekly-progress">0/5 workouts</div>
            <div class="progress-bar">
              <div class="progress-fill" id="weekly-fill" style="width: 0%;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Activity breakdown chart -->
    <div class="chart-card full-width">
      <h3>Activity Distribution</h3>
      <div class="chart-wrapper">
        <canvas id="distributionChart"></canvas>
      </div>
    </div>

    <!-- Data table with sortable columns -->
    <div class="data-table-container">
      <h3>Your Activity History</h3>
      <div class="table-controls">
        <button class="table-control-btn" id="export-csv">Export Data</button>
        <div class="table-search">
          <input type="text" id="table-search" placeholder="Search records...">
        </div>
      </div>
      <div class="table-wrapper">
        <table id="activityDataTable">
          <thead>
            <tr>
              <th>Date ↕</th>
              <th>Exercise Type ↕</th>
              <th>Duration (mins) ↕</th>
              <th>Calories ↕</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="activityDataBody">
            <!-- Data rows will be populated by JavaScript -->
          </tbody>
        </table>
      </div>
      <div class="table-pagination">
        <button id="prev-page" disabled>Previous</button>
        <span id="page-indicator">Page 1 of 1</span>
        <button id="next-page" disabled>Next</button>
      </div>
    </div>
    
    <!-- Extra analytics section -->
    <div class="extra-analytics">
      <h3>Detailed Analytics</h3>
      
      <!-- Exercise Intensity Analysis -->
      <div class="analytics-card">
        <h4>Intensity Analysis</h4>
        <div class="chart-wrapper">
          <canvas id="intensityChart"></canvas>
        </div>
        <div class="analytics-description">
          <p>This chart shows the distribution of your workouts by intensity level, calculated from duration and calories burnt.</p>
        </div>
      </div>
      
      <!-- Workout Consistency -->
      <div class="analytics-card">
        <h4>Workout Consistency</h4>
        <div class="chart-wrapper">
          <canvas id="consistencyChart"></canvas>
        </div>
        <div class="analytics-description">
          <p>This heatmap displays your workout frequency and consistency patterns over time.</p>
        </div>
      </div>
      
      <!-- Exercise Comparison -->
      <div class="analytics-card">
        <h4>Exercise Type Comparison</h4>
        <div class="chart-wrapper">
          <canvas id="comparisonChart"></canvas>
        </div>
        <div class="analytics-description">
          <p>Compare the efficiency of different exercise types based on calories burnt per minute.</p>
        </div>
      </div>
    </div>
    
    <!-- Goals and achievements section -->
    <div class="goals-container">
      <h3>Goals & Achievements</h3>
      <div class="goals-grid">
        <div class="goal-card">
          <div class="goal-icon">
            <img src="https://img.icons8.com/fluency/96/000000/goal.png" alt="Weekly Goal">
          </div>
          <div class="goal-info">
            <h4>Weekly Target</h4>
            <div class="goal-progress">
              <div class="goal-bar">
                <div class="goal-fill" id="weekly-goal-fill" style="width: 60%;"></div>
              </div>
              <div class="goal-value">3/5 workouts</div>
            </div>
          </div>
        </div>
        
        <div class="goal-card">
          <div class="goal-icon">
            <img src="https://img.icons8.com/fluency/96/000000/fire-element.png" alt="Calorie Goal">
          </div>
          <div class="goal-info">
            <h4>Calorie Target</h4>
            <div class="goal-progress">
              <div class="goal-bar">
                <div class="goal-fill" id="calorie-goal-fill" style="width: 75%;"></div>
              </div>
              <div class="goal-value">1875/2500 kcal</div>
            </div>
          </div>
        </div>
        
        <div class="goal-card">
          <div class="goal-icon">
            <img src="https://img.icons8.com/fluency/96/000000/trophy.png" alt="Achievement">
          </div>
          <div class="goal-info">
            <h4>Recent Achievement</h4>
            <p>Consistency Champion: 5 workouts in a row!</p>
          </div>
        </div>
        
        <div class="goal-card">
          <div class="goal-icon">
            <img src="https://img.icons8.com/fluency/96/000000/prize.png" alt="Next Milestone">
          </div>
          <div class="goal-info">
            <h4>Next Milestone</h4>
            <p>Marathon Master: 42km total running distance</p>
            <div class="goal-progress">
              <div class="goal-bar">
                <div class="goal-fill" style="width: 85%;"></div>
              </div>
              <div class="goal-value">35.7/42 km</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Recommendations section -->
    <div class="recommendations-container">
      <h3>Personal Recommendations</h3>
      <div class="recommendations-grid">
        <div class="recommendation-card">
          <div class="recommendation-icon">
            <img src="https://img.icons8.com/fluency/96/000000/idea.png" alt="Suggestion">
          </div>
          <div class="recommendation-content">
            <h4>Workout Suggestion</h4>
            <p>Your running performance is improving! Try increasing your distance by 10% in your next run.</p>
          </div>
        </div>
        
        <div class="recommendation-card">
          <div class="recommendation-icon">
            <img src="https://img.icons8.com/fluency/96/000000/calendar.png" alt="Schedule">
          </div>
          <div class="recommendation-content">
            <h4>Optimal Schedule</h4>
            <p>Based on your data, your performance is best in the morning. Try scheduling more workouts before noon.</p>
          </div>
        </div>
        
        <div class="recommendation-card">
          <div class="recommendation-icon">
            <img src="https://img.icons8.com/fluency/96/000000/handshake.png" alt="Balanced">
          </div>
          <div class="recommendation-content">
            <h4>Balance Suggestion</h4>
            <p>You're focusing mostly on cardio. Consider adding 1-2 strength training sessions per week for better results.</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Share prompt modal -->
  <div class="share-prompt" id="share-prompt" style="display: none;">
    <h3>Share Your Activity Data</h3>
    <p>Would you like to share your progress with friends?</p>
    <div class="share-options">
      <a href="{{ url_for('main.share_page') }}">
        <button class="share-btn">Share with friends</button>
      </a>
      <button class="cancel-btn" id="close-share-prompt">Not now</button>
    </div>
  </div>

  <script>
    // Pass the server data to JavaScript
    const serverData = {{ health_data|safe }};
    const initialTimePeriod = "{{ time_period }}";
    const userId = "{{ user_id }}";
  </script>
  <script src="{{ url_for('static', filename='js/visualize.js') }}"></script>
</body>
</html>